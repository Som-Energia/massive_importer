language: python
python:
  - "3.6"
env:
  global:
    - PIPENV_VENV_IN_PROJECT=1
    - PIPENV_IGNORE_VIRTUALENVS=1
services: 
  - docker
  - postgresql
before_install:
  - docker pull minio/minio 
  - docker run minio/minio -p 9000:9000 --name minio \
    -e 'MINIO_ACCESS_KEY=NJHXYRAAILTKUVSXWDP9' \
    -e 'MINIO_SECRET_KEY=IqoH+bHYxkfE8xvmLpMdaxjLGJkmhria3Qxi9Q73' \
    -v /mnt/data:/data \
    -v /mnt/config:/root/.minio \
    minio/minio server /data
  
  - docker pull minio/mc
  - docket run minio/mc /bin/sh -c "mc config host add minio http://localhost NJHXYRAAILTKUVSXWDP9 IqoH+bHYxkfE8xvmLpMdaxjLGJkmhria3Qxi9Q73 "
  - docket run minio/mc /bin/sh -c "mc mb minio/zips"
  - docket run minio/mc /bin/sh -c "mc event add minio/zips arn:minio:sqs::1:postgresql --suffix .zip"
  - docket run minio/mc /bin/sh -c "mc policy minio/zips public"
  
install:
  - pip install pipenv
  - pipenv install --dev --three
before_script:
  - psql -c 'create database bucketevents_db;' -U postgres
script:
  - pipenv run python -m unittest
